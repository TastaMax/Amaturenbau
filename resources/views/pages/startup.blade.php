<!doctype html>
<html lang="de">
<head>
    @include('layouts.head')
</head>
<body>

<section class="mb-10 position-relative" style="min-height: 100vh;">
    <svg
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        class="position-absolute"
        style="
              margin: auto;
              display: block;
              width: 100%;
              z-index: -10;
              position: relative;
              "
        height="680"
        preserveAspectRatio="none"
        viewBox="0 0 1920 880"
    >
        <g transform="translate(960,440) scale(1,1) translate(-960,-440)">
            <linearGradient
                id="lg-0.047955344060927496"
                x1="0"
                x2="1"
                y1="0"
                y2="0"
            >
                <stop stop-color="hsl(217, 88%, 33.7%)" offset="0"></stop>
                <stop stop-color="hsl(217, 88%, 75.1%)" offset="1"></stop>
            </linearGradient>
            <path d="" fill="url(#lg-0.047955344060927496)" opacity="0.4">
                <animate
                    attributeName="d"
                    dur="33.333333333333336s"
                    repeatCount="indefinite"
                    keyTimes="0;0.333;0.667;1"
                    calcmod="spline"
                    keySplines="0.2 0 0.2 1;0.2 0 0.2 1;0.2 0 0.2 1"
                    begin="0s"
                    values="M0 0L 0 804.2328934685746Q 320 597.3613372284876  640 571.0708916590191T 1280 512.0661063245175T 1920 301.8788007488083L 1920 0 Z;M0 0L 0 877.6839081951588Q 320 668.0720922803877  640 649.0018928349388T 1280 328.7087077664202T 1920 162.95038242563396L 1920 0 Z;M0 0L 0 724.9886210051687Q 320 661.4364572061575  640 623.2173947479624T 1280 359.20353038907734T 1920 135.51673041732283L 1920 0 Z;M0 0L 0 804.2328934685746Q 320 597.3613372284876  640 571.0708916590191T 1280 512.0661063245175T 1920 301.8788007488083L 1920 0 Z"
                ></animate>
            </path>
            <path d="" fill="url(#lg-0.047955344060927496)" opacity="0.4">
                <animate
                    attributeName="d"
                    dur="33.333333333333336s"
                    repeatCount="indefinite"
                    keyTimes="0;0.333;0.667;1"
                    calcmod="spline"
                    keySplines="0.2 0 0.2 1;0.2 0 0.2 1;0.2 0 0.2 1"
                    begin="-6.666666666666667s"
                    values="M0 0L 0 765.7607191473613Q 320 641.7853945676919  640 624.2534689988059T 1280 365.27264408032966T 1920 190.38947978522663L 1920 0 Z;M0 0L 0 842.1984196370487Q 320 570.6690721707517  640 540.6844954979398T 1280 439.92879442880593T 1920 200.29713960445451L 1920 0 Z;M0 0L 0 796.6802345094818Q 320 721.9216894353016  640 696.8815669355181T 1280 373.6367381440213T 1920 196.63169821789495L 1920 0 Z;M0 0L 0 765.7607191473613Q 320 641.7853945676919  640 624.2534689988059T 1280 365.27264408032966T 1920 190.38947978522663L 1920 0 Z"
                ></animate>
            </path>
            <path d="" fill="url(#lg-0.047955344060927496)" opacity="0.4">
                <animate
                    attributeName="d"
                    dur="33.333333333333336s"
                    repeatCount="indefinite"
                    keyTimes="0;0.333;0.667;1"
                    calcmod="spline"
                    keySplines="0.2 0 0.2 1;0.2 0 0.2 1;0.2 0 0.2 1"
                    begin="-13.333333333333334s"
                    values="M0 0L 0 801.7562714943509Q 320 634.0247183381232  640 605.7090791951217T 1280 503.9393370140325T 1920 224.7551247480177L 1920 0 Z;M0 0L 0 821.0401780336218Q 320 670.8690783540507  640 637.0744123031742T 1280 456.40745286432224T 1920 278.1294357804296L 1920 0 Z;M0 0L 0 744.0534225112256Q 320 637.6425395409125  640 593.2079605185819T 1280 457.03995196824286T 1920 254.87693899994804L 1920 0 Z;M0 0L 0 801.7562714943509Q 320 634.0247183381232  640 605.7090791951217T 1280 503.9393370140325T 1920 224.7551247480177L 1920 0 Z"
                ></animate>
            </path>
            <path d="" fill="url(#lg-0.047955344060927496)" opacity="0.4">
                <animate
                    attributeName="d"
                    dur="33.333333333333336s"
                    repeatCount="indefinite"
                    keyTimes="0;0.333;0.667;1"
                    calcmod="spline"
                    keySplines="0.2 0 0.2 1;0.2 0 0.2 1;0.2 0 0.2 1"
                    begin="-20s"
                    values="M0 0L 0 817.8603658675457Q 320 592.9404308081629  640 559.1126621853513T 1280 428.9912604821798T 1920 209.017381620229L 1920 0 Z;M0 0L 0 802.0504889976935Q 320 561.3963273210122  640 537.6024084387631T 1280 430.41283267566695T 1920 256.1972069733954L 1920 0 Z;M0 0L 0 789.4448177495887Q 320 561.9675446430498  640 531.6192318019404T 1280 414.76018143244175T 1920 265.9163329632971L 1920 0 Z;M0 0L 0 817.8603658675457Q 320 592.9404308081629  640 559.1126621853513T 1280 428.9912604821798T 1920 209.017381620229L 1920 0 Z"
                ></animate>
            </path>
            <path d="" fill="url(#lg-0.047955344060927496)" opacity="0.4">
                <animate
                    attributeName="d"
                    dur="33.333333333333336s"
                    repeatCount="indefinite"
                    keyTimes="0;0.333;0.667;1"
                    calcmod="spline"
                    keySplines="0.2 0 0.2 1;0.2 0 0.2 1;0.2 0 0.2 1"
                    begin="-26.666666666666668s"
                    values="M0 0L 0 844.0541574423102Q 320 623.0697081316591  640 592.8483890737847T 1280 469.85448734523794T 1920 190.81850676853674L 1920 0 Z;M0 0L 0 871.4928294956283Q 320 618.9784567388518  640 593.1183717103518T 1280 376.5051942642811T 1920 141.32293927545027L 1920 0 Z;M0 0L 0 782.0118384610068Q 320 727.3267836497654  640 694.0476176759635T 1280 518.1545471640493T 1920 276.0053882957168L 1920 0 Z;M0 0L 0 844.0541574423102Q 320 623.0697081316591  640 592.8483890737847T 1280 469.85448734523794T 1920 190.81850676853674L 1920 0 Z"
                ></animate>
            </path>
        </g>
    </svg>

    <div class="container">
        <div class="d-flex justify-content-center text-center mx-3">
            <div
                class="card p-4 py-5 shadow-3-strong w-100"
                style="
                    margin-top: 180px;
                "
            >
                <form action="{{ route('startup') }}" method="POST">
                    <div class="card-body">

                        <h1 class="mt-4 mb-5 display-3 fw-bold ls-tight">
                            Einrichtung & Installation
                        </h1>

                        @include('partials.error')

                        @if($dbError !== true)
                            <div class="alert alert-danger mt-3" role="alert">
                                <i class="fas fa-times-circle me-3"></i> Leider ist ein Fehler in der Datenbank aufgetreten! Bitte beachten Sie folgende Dinge:
                                <p>
                                    {{ $dbError }}
                                </p>
                            </div>
                        @endif
                        @if (Session::has('error'))
                            <div class="alert alert-danger mt-3" role="alert">
                                <i class="fas fa-times-circle me-3"></i> Leider ist ein Fehler in der Datenbank aufgetreten! Bitte beachten Sie folgende Dinge:
                                <p>
                                    {{ Session::get('error') }}
                                </p>
                            </div>
                        @endif

                        @if($state === 0 || is_null($state))
                            <h2 class="mb-3">
                                Anforderungen für PHP
                            </h2>
                            <p>
                                Die Einstellungen treffen Sie in Ihrer PHP Environment.<br>
                                Hierfür müssen Sie vorkehrungen in der php.ini treffen!
                            </p>
                            <div class="row justify-content-center mb-5">
                                <div class="col-md-4">
                                    <ul class="list-group list-group-light">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="fw-bold text-start">Maximale Dateigröße für Uploads</div>
                                                <div class="text-muted text-start">Aktuell: {{ ini_get('upload_max_filesize') }}<br> Empfohlen: 1000M</div>
                                            </div>
                                            @if($phpSettings['maxFileSize'] >= 1073741824)
                                                <h2 class="badge rounded-pill badge-success p-2"><i class="fa-solid fa-check" style="font-size: 1.3em;"></i></h2>
                                            @else
                                                <h2 class="badge rounded-pill badge-warning p-2"><i class="fa-solid fa-triangle-exclamation" style="font-size: 1.3em;"></i></h2>
                                            @endif
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="fw-bold text-start">Timeout</div>
                                                <div class="text-muted text-start">Aktuell: {{ $phpSettings['timeout'] }} Sekunden<br> Empfohlen: 300 Sekunden</div>
                                            </div>
                                            @if($phpSettings['timeout'] >= 300)
                                                <h2 class="badge rounded-pill badge-success p-2"><i class="fa-solid fa-check" style="font-size: 1.3em;"></i></h2>
                                            @else
                                                <h2 class="badge rounded-pill badge-warning p-2"><i class="fa-solid fa-triangle-exclamation" style="font-size: 1.3em;"></i></h2>
                                            @endif
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="fw-bold text-start">Memory Limit</div>
                                                <div class="text-muted text-start">Aktuell: {{ ini_get('memory_limit') }}<br> Empfohlen: 512M</div>
                                            </div>
                                            @if($phpSettings['memoryLimit'] >= 536870912 )
                                                <h2 class="badge rounded-pill badge-success p-2"><i class="fa-solid fa-check" style="font-size: 1.3em;"></i></h2>
                                            @else
                                                <h2 class="badge rounded-pill badge-warning p-2"><i class="fa-solid fa-triangle-exclamation" style="font-size: 1.3em;"></i></h2>
                                            @endif
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="fw-bold text-start">MSSQL Extension</div>
                                                @if($phpSettings['mssql'])
                                                    <div class="text-muted text-start">Erfolgreich installiert.</div>
                                                @else
                                                    <div class="text-muted text-start">Nicht installiert!</div>
                                                @endif
                                            </div>
                                            @if($phpSettings['mssql'])
                                                <h2 class="badge rounded-pill badge-success p-2"><i class="fa-solid fa-check" style="font-size: 1.3em;"></i></h2>
                                            @else
                                                <h2 class="badge rounded-pill badge-danger p-2"><i class="fa-solid fa-triangle-exclamation" style="font-size: 1.3em;"></i></h2>
                                            @endif
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <h2 class="mb-3">
                                Allgemeine Einstellungen
                            </h2>

                            @csrf

                            <div class="row justify-content-center">
                                <div class="col-md-6">

                                    <div class="form-outline mb-3">
                                        <input type="text" id="Firmenname" name="companyName" value="{{ env('APP_COMPANY') }}" class="form-control" required/>
                                        <label class="form-label" for="Firmenname">Firmenname</label>
                                    </div>

                                    <div class="form-outline mb-3">
                                        <input type="text" id="formUrl" name="appUrl" value="{{ env('APP_URL') }}" class="form-control" required/>
                                        <label class="form-label" for="formUrl">App URL</label>
                                    </div>
                                </div>
                            </div>

                        @elseif($state === 1)
                            <h2 class="mb-3">
                                Datenbank Einstellungen MariaDB/MySQL
                            </h2>
                            @csrf

                            <div class="row justify-content-center">
                                <div class="col-md-6">

                                    <div class="form-outline mb-3" data-mdb-input-init>
                                        <input type="text" id="host" name="host" value="{{ env('DB_HOST') }}" class="form-control" required/>
                                        <label class="form-label" for="host">Datenbank Host</label>
                                    </div>

                                    <div class="form-outline mb-3" data-mdb-input-init>
                                        <input type="text" id="port" name="port" value="{{ env('DB_PORT') }}" class="form-control" required/>
                                        <label class="form-label" for="port">Datenbank Port</label>
                                    </div>

                                    <div class="form-outline mb-3" data-mdb-input-init>
                                        <input type="text" id="name" name="name" value="{{ env('DB_DATABASE') }}" class="form-control" required/>
                                        <label class="form-label" for="name">Datenbank Name</label>
                                    </div>

                                    <div class="form-outline mb-3" data-mdb-input-init>
                                        <input type="text" id="username" name="username" value="{{ env('DB_USERNAME') }}" class="form-control" required/>
                                        <label class="form-label" for="username">Datenbank Benutzername</label>
                                    </div>

                                    <div class="form-outline mb-3" data-mdb-input-init>
                                        <input type="password" id="password" name="password" value="{{ env('DB_PASSWORD') }}" class="form-control"/>
                                        <label class="form-label" for="password">Datenbank Passwort</label>
                                    </div>
                                </div>
                            </div>
                        @elseif($state === 2)
                            <h2 class="mb-3">
                                ShopWare 6 Einstellungen
                            </h2>
                            <p>
                                Bitte geben Sie die URL mit HTTP/S an.<br>
                                Erstellen Sie in Ihrem Shop unter "Einstellungen/System/Integration" bitte einen API-Token.<br>
                                Geben Sie die Berechtigung Administrator um eventuelle Berechtigungsfehler auszuschließen!
                            </p>

                            @csrf

                            <div class="row justify-content-center">
                                <div class="col-md-6">

                                    <div class="form-outline @if(!$shopwareConnection) mb-5 @else mb-3 @endif" data-mdb-input-init>
                                        <input type="text" class="form-control @if(!$shopwareConnection) is-invalid @endif @if($shopwareConnection === 1) is-valid @endif" id="shopwareurl" name="shopwareurl" value="{{ env('SHOPWARE_BASE_URL') }}" required />
                                        <label for="shopwareurl" class="form-label">ShopWare Adresse</label>
                                        @if(!$shopwareConnection) <div class="invalid-feedback">Leider konnte keine Verbindung zur ShopWare API hergestellt werden.</div> @endif
                                        @if($shopwareConnection === 1) <div class="valid-feedback">Verbindung zur ShopWare API hergestellt!</div> @endif
                                    </div>
                                    <div class="form-outline @if(!$shopwareToken) mb-5 @else mb-3 @endif" data-mdb-input-init>
                                        <input type="text" class="form-control @if(!$shopwareToken) is-invalid @endif @if($shopwareToken === 1) is-valid @endif" id="shopwareid" name="shopwareid" value="{{ env('SHOPWARE_CLIENT_ID') }}" required />
                                        <label for="shopwareid" class="form-label">Zugangs-ID</label>
                                        @if(!$shopwareToken) <div class="invalid-feedback"> @if(!$shopwareConnection) Der Token konnte nicht überprüft werden. Überprüfen Sie die Verbindung mit der ShopWare API. @else Der Token ist leider ungültig. @endif</div> @endif
                                        @if($shopwareToken === 1) <div class="valid-feedback">Die Zugangs-ID ist gültig!</div> @endif
                                    </div>
                                    <div class="form-outline @if(!$shopwareToken) mb-5 @else mb-3 @endif" data-mdb-input-init>
                                        <input type="text" class="form-control @if(!$shopwareToken) is-invalid @endif @if($shopwareToken === 1) is-valid @endif" id="shopwaretoken" name="shopwaretoken" value="{{ env('SHOPWARE_API_KEY') }}" required />
                                        <label for="shopwaretoken" class="form-label">Sicherheitsschlüssel</label>
                                        @if(!$shopwareToken) <div class="invalid-feedback"> @if(!$shopwareConnection) Der Token konnte nicht überprüft werden. Überprüfen Sie die Verbindung mit der ShopWare API. @else Der Token ist leider ungültig. @endif</div> @endif
                                        @if($shopwareToken === 1) <div class="valid-feedback">Der Sicherheitsschlüssel ist gültig!</div> @endif
                                    </div>

                                    @if(!$shopwareConnection || !$shopwareToken)
                                        <div class="form-outline mb-5" data-mdb-input-init>
                                            <input type="text" class="form-control is-invalid" id="shopwaretoken" name="shopwaretoken" value="{{ env('SHOPWARE_SALES_CHANNEL_ID') }}" disabled />
                                            <label for="shopwaretoken" class="form-label">Verkaufskanal</label>
                                            <div class="invalid-feedback">Eine Änderung des Verkaufskanals ist aufgrund der Verbindung oder des Tokens nicht möglich!</div>
                                        </div>
                                    @else
                                        <div class="mb-3">
                                            <select class="select" name="shopwaresaleschannelid" data-mdb-select-init>
                                                @foreach($shopwareSalesChannels['body']['data'] as $salesChannel)
                                                    <option value="{{ $salesChannel['id'] }}" data-mdb-secondary-text="{{ $salesChannel['id'] }}">{{ $salesChannel['name'] }}</option>
                                                @endforeach
                                            </select>
                                            <label class="form-label select-label">Verkaufskanal</label>
                                        </div>
                                    @endif
                                </div>
                            </div>
                        @else
                            <h2 class="mb-3">
                                Zusammenfassung & Abschließen
                            </h2>
                            <ul class="list-group list-group-light">
                                <li class="list-group-item">
                                    <h5 class="d-flex align-items-center">
                                        <i class="fa-solid fa-2x fa-check text-success me-2"></i>
                                        Allgemeine Einstellungen
                                    </h5>
                                </li>
                                <li class="list-group-item">
                                    <h5 class="d-flex align-items-center">
                                        <i class="fa-solid fa-2x fa-check text-success me-2"></i>
                                        MariaDB/MySQL
                                    </h5>
                                </li>
                                <li class="list-group-item">
                                    <h5 class="d-flex align-items-center">
                                        <i class="fa-solid fa-2x fa-check text-success me-2"></i>
                                       ShopWare 6 Zugang
                                    </h5>
                                </li>
                                <li class="list-group-item">
                                    <h5 class="d-flex align-items-center">
                                        <i class="fa-solid fa-2x fa-ellipsis me-2"></i>
                                        Migration auf Datenbank ausführen
                                    </h5>
                                    <p class="text-start">Führen Sie jetzt die Migration der Datenbank durch!</p>
                                </li>
                            </ul>

                            @csrf

                            <h5 class="text-start mb-3">Bitte geben Sie jetzt Ihren Administrator Zugang ein.</h5>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-outline mb-3" data-mdb-input-init>
                                        <input type="email" id="email" name="email" class="form-control" required/>
                                        <label class="form-label" for="email">E-Mail-Adresse</label>
                                    </div>

                                    <div class="form-outline mb-3" data-mdb-input-init>
                                        <input type="password" id="password" name="password" class="form-control" required/>
                                        <label class="form-label" for="password">Passwort</label>
                                    </div>
                                </div>

                            </div>

                        @endif


                    </div>
                    <div class="card-footer">
                        <button type="submit" name="submit" value="{{ $state }}" class="btn btn-primary float-end">Weiter</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>



@include('layouts.footer')

@include('partials.alert')

@vite(['resources/js/app.js'])

@stack('scripts')
</body>
</html>
